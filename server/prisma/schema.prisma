generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  name     String?
  email    String  @unique
  password String
  role     String  @default("DONOR")
  language String  @default("en")

  mosqueId  String?  @db.ObjectId
  createdAt DateTime @default(now())

  donations         Donation[]
  zakatCalculations ZakatCalculation[]
  donationRequests  DonationRequest[]

  mosque Mosque? @relation(fields: [mosqueId], references: [id])
}

model Donation {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  amount    Float
  type      String?
  note      String?
  status    String   @default("PENDING") // PENDING | RECEIVED
  createdAt DateTime @default(now())

  approvedBy String?   @db.ObjectId
  approvedAt DateTime?

  donorId String @db.ObjectId
  donor   User   @relation(fields: [donorId], references: [id])
}

model SystemBalance {
  id      String @id @default("SYSTEM") @map("_id")
  balance Float  @default(0)

  @@map("system_balance")
}

model DonationRequest {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  mosqueAdminId  String   @db.ObjectId

  amount         Float
  description    String?
  status         String   @default("PENDING")

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  approvedBy     String?
  rejectedBy     String?
  approvedAt     DateTime?
  rejectedAt     DateTime?
  sentAmount     Float?

  admin          User     @relation(fields: [mosqueAdminId], references: [id])
}



model ZakatCalculation {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String   @db.ObjectId
  zakatType    String
  wealthType   String?
  wealthAmount Float
  nisabValue   Float?
  zakatRate    Float?
  zakatDue     Float?
  explanation  String
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Mosque {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  location  String
  createdAt DateTime @default(now())

  beneficiaries Beneficiary[]
  users         User[] // back-relation to User
  adminInvites  MosqueAdminInvite[]
}

model Beneficiary {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  description   String
  gender        String
  maritalStatus String
  familiesCount Int     @default(1)
  phone         String?
  address       String?
  verified      Boolean @default(true)

  mosqueId String @db.ObjectId
  mosque   Mosque @relation(fields: [mosqueId], references: [id])

  

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Project {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  title      String
  goalAmount Float
  raised     Float    @default(0)
  createdAt  DateTime @default(now())
}

model MosqueAdminInvite {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  email String

  mosqueId  String   @db.ObjectId
  token     String   @unique
  role      String   @default("MOSQUE_ADMIN")
  status    String   @default("PENDING")
  expiresAt DateTime
  createdAt DateTime @default(now())

  mosque Mosque @relation(fields: [mosqueId], references: [id])
}
